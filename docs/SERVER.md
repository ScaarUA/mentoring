## JSMP3.6: JavaScript on Backend (Huseinov B.)
### Задачи
 1. __Организовать сущность Project__;
Расположение: *server/api/project/*

С помощью *mongoose* была создана модель Project , которая хранит в себе список пользователей, которые могут её просматривать, а также те пользователи, которые могут её модифицировать. Также содержит список из Flow, которые ей принадлежат. Все эти данные препопуляризируются с помощью плагина для монгуза deepPopulate. Продуманы эндпоинты для нахождения всех, одного Project, а также создание, удаление и модификация его в соответствии с типичной REST API. Добавлена возможность для текущего юзера в сессии находить проекты (модель Project) , которые он может читать (или редактировать в зависимости от типа запроса).

Маршруты:

```sh
GET, POST: /api/projects/

GET, PUT, DELETE: /api/projects/:id
```

 2. **Организовать сущность User**
Расположение: *server/api/user/*

Также была создана модель User. В отличии от Project, у User отсутствует препопуляция, но модель содержит в себе два объекта авторизации как локальной, так и через google по OAUTH 2.0. Также сделаны все эндпоинты кроме создания (этим занимается passport).
 
Маршруты:

```sh
GET: /api/users

GET, PUT: /api/users/:id
```

 3. **Создать регистрацию авторизацию пользователей**
Расположение: *server/authorization/*

При помощи *passportJS* создана возможность регистрации и авторизации пользователей как локально так и через google API. Для локальных регистрации и логина были созданы две соответствующие стратегии passport-local которые взаимодействуют с моделью User. Для логина через google API была настроена стратегия от модуля passport-google-oauth, запрашиваем у google разрешения на чтение данных профиля и email (нас перенаправит на страничку с подтверждением разрешение этих данных). После получения данных мы их сверяем с базой данных: если таких данных еще нет - записываем их в базу, если есть - сразу авторизируемся, пользователь ложится в сессию. Итого модель юзера может содержать как локальные данные так и данные от google.
После любого типа авторизации пользователь хранится в сессии. Сессия настроена на 5 полных дней.
Также был создан перехватчик проверки на авторизацию (middleware server/helpers/auth.interceptor.js), который возможно использовать на любой маршрут. Проверяет есть ли юзер в сессии и в зависимости от этого дает или не дает доступ к дальнейшим middleware. Применен для всех маршрутов /api.

Маршруты:

```sh
GET: /auth/logout - закрытие сессии
POST: /auth/local/signup - локальная регистрация
POST: /auth/local/login - локальный логин
GET: /auth/google - логин через google API
GET: /auth/google/callback - callback на который редиректит обратно google API после попытки логина
```